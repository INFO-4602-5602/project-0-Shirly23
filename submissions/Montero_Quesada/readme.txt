I've got advice from Santhanakrishnan Ramani. The other sources are commented in the code.
